--Order of deletion of tables
--drop table badger;
--drop table employee;
--drop table historique;
--drop table signaler;
--drop table gerer;
--drop table capteur;
--drop table partie_commune;
--drop table surveiller;
--drop table resident;

--Destruction of base
DROP DATABASE pds;

--Creation base
CREATE DATABASE pds
    WITH 
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'French_France.1252'
    LC_CTYPE = 'French_France.1252'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;

--Creation tables
CREATE TABLE public.employee
(
    id_employee integer NOT NULL DEFAULT,
    nom_employee text COLLATE pg_catalog."default" NOT NULL,
    prenom_employee text COLLATE pg_catalog."default" NOT NULL,
    mot_de_passe text COLLATE pg_catalog."default" NOT NULL,
    poste text COLLATE pg_catalog."default",
    CONSTRAINT employee_pkey PRIMARY KEY (id_employee)
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.employee
    OWNER to postgres;
    
CREATE TABLE public.resident
(
    id_resident integer NOT NULL,
    nom_resident text COLLATE pg_catalog."default" NOT NULL,
    prenom_resident text COLLATE pg_catalog."default",
    CONSTRAINT resident_pkey PRIMARY KEY (id_resident)
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.resident
    OWNER to postgres;

CREATE TABLE public.partie_commune
(
    id_partie_commune integer NOT NULL,
    nom_partie_commune text COLLATE pg_catalog."default" NOT NULL,
    etage_partie_commune integer NOT NULL,
    CONSTRAINT partie_commune_pkey PRIMARY KEY (id_partie_commune)
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.partie_commune
    OWNER to postgres;

CREATE TABLE public.capteur
(
    id_capteur integer NOT NULL,
    type_capteur text COLLATE pg_catalog."default" NOT NULL,
    etat text COLLATE pg_catalog."default" NOT NULL,
    id_partie_commune integer,
    CONSTRAINT capteur_pkey PRIMARY KEY (id_capteur),
    CONSTRAINT id_partie_commune FOREIGN KEY (id_partie_commune)
        REFERENCES public.partie_commune (id_partie_commune) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.capteur
    OWNER to postgres;

CREATE INDEX fki_id_partie_commune
    ON public.capteur USING btree
    (id_partie_commune)
    TABLESPACE pg_default;
    
CREATE TABLE public.surveiller
(
    id_employee integer NOT NULL,
    id_resident integer NOT NULL,
    CONSTRAINT surveiller_pkey PRIMARY KEY (id_employee, id_resident),
    CONSTRAINT id_employee FOREIGN KEY (id_employee)
        REFERENCES public.employee (id_employee) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION,
    CONSTRAINT id_resident FOREIGN KEY (id_resident)
        REFERENCES public.resident (id_resident) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.surveiller
    OWNER to postgres;

CREATE TABLE public.gerer
(
    id_employe integer NOT NULL,
    id_capteur integer NOT NULL,
    CONSTRAINT gerer_pkey PRIMARY KEY (id_employe, id_capteur),
    CONSTRAINT id_capteur FOREIGN KEY (id_capteur)
        REFERENCES public.capteur (id_capteur) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION,
    CONSTRAINT id_employee FOREIGN KEY (id_employe)
        REFERENCES public.employee (id_employee) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.gerer
    OWNER to postgres;

CREATE INDEX fki_id_capteur
    ON public.gerer USING btree
    (id_capteur)
    TABLESPACE pg_default;

CREATE INDEX fki_id_employee
    ON public.gerer USING btree
    (id_employe)
    TABLESPACE pg_default;

CREATE TABLE public.signaler
(
    id_capteur integer NOT NULL,
    id_employee integer NOT NULL,
    CONSTRAINT signaler_pkey PRIMARY KEY (id_capteur, id_employee),
    CONSTRAINT id_capteur FOREIGN KEY (id_capteur)
        REFERENCES public.capteur (id_capteur) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION,
    CONSTRAINT id_employee FOREIGN KEY (id_employee)
        REFERENCES public.employee (id_employee) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.signaler
    OWNER to postgres;

CREATE TABLE public.historique
(
    id_historique integer NOT NULL,
    date_historique timestamp without time zone NOT NULL,
    etat_avant text COLLATE pg_catalog."default" NOT NULL,
    etat_apres text COLLATE pg_catalog."default" NOT NULL,
    id_capteur integer NOT NULL,
    CONSTRAINT historique_pkey PRIMARY KEY (id_historique),
    CONSTRAINT id_capteur FOREIGN KEY (id_capteur)
        REFERENCES public.capteur (id_capteur) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.historique
    OWNER to postgres;

CREATE TABLE public.badger
(
    id_resident integer NOT NULL,
    id_capteur integer NOT NULL,
    date_badger timestamp without time zone NOT NULL,
    CONSTRAINT badger_pkey PRIMARY KEY (id_resident, id_capteur),
    CONSTRAINT id_resident FOREIGN KEY (id_resident)
        REFERENCES public.resident (id_resident) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.badger
    OWNER to postgres;

CREATE INDEX fki_id_resident
    ON public.badger USING btree
    (id_resident)
    TABLESPACE pg_default;